TEST1 PROJECT - COMPREHENSIVE KNOWLEDGE BASE
==============================================

PROJECT OVERVIEW
================
Project Name: Test1 KB Badge Validation Project
Project ID: 5
Created: January 2026
Owner: Test User (tenant_20251202232822)
Status: Active - Phase 4 In Progress

Mission Statement:
The Test1 project is dedicated to validating and demonstrating the Knowledge Base Badge functionality in the Tsushin platform. This project serves as a comprehensive testing environment for semantic search, source attribution, and visual indicators that help users understand which knowledge sources were consulted when generating AI responses.

TEAM MEMBERS
============
The Test1 project team consists of four dedicated professionals:

1. Sarah Chen - Project Lead & Product Manager
   - Email: sarah.chen@test1project.example.com
   - Responsibilities: Overall project coordination, requirements gathering, stakeholder communication
   - Location: San Francisco, CA
   - Years of Experience: 8 years in AI/ML product management

2. Michael Rodriguez - Backend Developer
   - Email: michael.rodriguez@test1project.example.com
   - Responsibilities: ChromaDB integration, embedding generation, vector search implementation
   - Specialization: Python, FastAPI, Vector databases
   - Location: Austin, TX
   - Years of Experience: 6 years in backend development

3. Emma Watson - Frontend Developer
   - Email: emma.watson@test1project.example.com
   - Responsibilities: Badge UI components, color coding system, expandable document views
   - Specialization: React, TypeScript, Tailwind CSS
   - Location: London, UK
   - Years of Experience: 5 years in frontend development

4. David Kim - QA Engineer & Test Specialist
   - Email: david.kim@test1project.example.com
   - Responsibilities: Test scenario creation, automated testing, validation protocols
   - Specialization: Browser automation, API testing, E2E testing
   - Location: Seattle, WA
   - Years of Experience: 7 years in quality assurance

PROJECT GOALS AND OBJECTIVES
============================
The primary goals of the Test1 project are:

Goal 1: Validate Semantic Search Functionality
- Ensure document chunks are properly embedded using all-MiniLM-L6-v2 model
- Verify cosine similarity calculations are accurate
- Test relevance ranking across different query types
- Validate minimum similarity threshold filtering (0.3 or 30%)

Goal 2: Test KB Badge Display System
- Verify badges appear when knowledge base sources are used
- Ensure proper source attribution (Agent, Project, or Agent + Project)
- Test visual indicators (dots) with correct color coding
- Validate expandable detail views showing individual chunks

Goal 3: Verify Combined Knowledge Search
- Test simultaneous search across Agent KB and Project KB
- Ensure intelligent merging and deduplication of results
- Validate proper sorting by similarity score
- Verify separate source attribution is maintained

Goal 4: Ensure Color-Coded Visual Indicators Work Correctly
- Cyan/Orange dots for Agent KB sources
- Blue dots for Project KB sources
- Mixed colors when both sources are used
- Proper visual distinction in all UI states

Goal 5: Test Similarity Score Calculations
- Verify scores are displayed with proper precision
- Ensure threshold filtering works (remove results below 0.3)
- Test that scores accurately reflect semantic relevance
- Validate sorting by similarity in descending order

TECHNICAL ARCHITECTURE
======================

Embedding Model Configuration:
- Model: all-MiniLM-L6-v2 (SentenceTransformer)
- Embedding Dimension: 384
- Maximum Sequence Length: 256 tokens
- Purpose: Converting text chunks into dense vector representations

Vector Database Setup:
- Database: ChromaDB (Persistent Client)
- Collection Name: project_5
- Storage Path: /app/data/chroma/project_5
- Distance Metric: Cosine similarity
- Persistence: Disk-based storage

Document Processing Pipeline:
- Chunk Size: 500 characters
- Chunk Overlap: 50 characters (10% overlap)
- Supported Formats: TXT, CSV, JSON, PDF, DOCX
- Processing Stages: Upload â†’ Chunking â†’ Embedding â†’ Indexing
- Status Flow: pending â†’ processing â†’ completed

Search Configuration:
- Similarity Threshold: 0.3 (30%)
- Maximum Results: 5 chunks per query
- Search Type: Semantic search (embedding-based)
- Deduplication: Enabled (removes duplicate chunks)

Backend Services:
- combined_knowledge_service.py: Handles Agent + Project KB search
- project_service.py: Manages project KB lifecycle
- knowledge_service.py: Manages agent KB operations

Frontend Components:
- KBUsageBadge.tsx: Main badge component with expandable details
- Color coding: Tailwind CSS classes for blue/cyan dots
- Badge labels: (Agent), (Project), (Agent + Project)

PROJECT TIMELINE AND MILESTONES
===============================

Phase 1: Initial Setup (Completed - December 2025)
- Project creation and team onboarding
- Database schema design for project_knowledge table
- Basic file upload infrastructure
- ChromaDB integration setup

Phase 2: Document Processing (Completed - December 2025)
- Document chunking algorithm implementation
- Embedding generation pipeline
- Chunk storage in PostgreSQL and ChromaDB
- Status tracking and error handling

Phase 3: Semantic Search Implementation (Completed - January 2026)
- Vector similarity search implementation
- Query embedding generation
- Result ranking and filtering
- Combined knowledge search (Agent + Project)

Phase 4: KB Badge Visual Indicators (In Progress - January 2026)
- Badge component UI development
- Source attribution system
- Color coding implementation
- Expandable detail views
- Bug fixes (chunk_index, CHROMA_DIR attribute)

Phase 5: Advanced Features (Planned - February 2026)
- Relevance tuning and threshold optimization
- Advanced filtering options
- Performance optimization for large KBs
- User preferences for badge display

KEY FEATURES BEING TESTED
=========================

Feature 1: Document Upload and Processing
Description: Users can upload documents to project knowledge bases through the UI or API. The system automatically processes these documents by chunking them into smaller segments, generating embeddings, and indexing them in ChromaDB.

Technical Details:
- File validation: Type checking and size limits (10 MB max)
- Chunking: Overlapping chunks for context preservation
- Embeddings: Generated using SentenceTransformer model
- Status tracking: Real-time status updates (processing â†’ completed)

Test Cases:
- Upload TXT file: Should process successfully
- Upload large file: Should handle or reject appropriately
- Upload invalid format: Should display error message

Feature 2: Semantic Search and Retrieval
Description: Natural language queries are converted to embeddings and matched against document chunks using cosine similarity. Results are ranked by relevance and filtered by minimum threshold.

Technical Details:
- Query processing: Text â†’ Embedding â†’ Vector search
- Similarity calculation: Cosine distance in 384-dimensional space
- Threshold filtering: Removes results below 0.3 similarity
- Result limiting: Returns top 5 most relevant chunks

Test Cases:
- Specific query: "Who are the Test1 team members?"
- Broad query: "What is Test1 project about?"
- Irrelevant query: Should return no results or low similarity scores

Feature 3: KB Badge Display and Source Attribution
Description: Visual badges appear next to AI responses showing which knowledge base documents were consulted. Badges display document names, chunk indices, similarity scores, and source type labels.

Technical Details:
- Badge rendering: Conditional display based on KB usage
- Color coding: CSS classes for blue (project) and cyan (agent) dots
- Expandable UI: Click to view all document chunks used
- Label logic: (Agent), (Project), or (Agent + Project)

Test Cases:
- Agent KB only: Should show cyan dots and "(Agent)" label
- Project KB only: Should show blue dots and "(Project)" label
- Combined KB: Should show mixed colors and "(Agent + Project)" label

Feature 4: Combined Knowledge Search
Description: When an agent operates within a project context, both the agent's personal KB and the project's KB are searched simultaneously. Results are merged, deduplicated, and sorted by relevance.

Technical Details:
- Parallel search: Agent KB and Project KB searched concurrently
- Result merging: Combine results from both sources
- Deduplication: Remove duplicate chunks based on content hash
- Source tracking: Maintain source_type field for attribution

Test Cases:
- Agent with KB in project: Should search both sources
- Agent without KB in project: Should search only project KB
- Agent outside project: Should search only agent KB

PROJECT CHALLENGES AND SOLUTIONS
================================

Challenge 1: Collection Naming Consistency
Problem: Inconsistent naming patterns between agent KB (knowledge_agent_{id}) and project KB (project_{id}) caused confusion and lookup failures.
Solution: Standardized collection naming conventions and updated all services to use consistent patterns.
Impact: Resolved lookup failures, improved code maintainability.

Challenge 2: ChromaDB Directory Configuration
Problem: Code referenced incorrect settings attribute (CHROMA_PERSIST_DIR instead of CHROMA_DIR), causing path resolution failures.
Solution: Corrected attribute name in project_service.py (4 locations) and combined_knowledge_service.py.
Impact: Fixed "AttributeError" exceptions, restored project KB functionality.

Challenge 3: Agent KB Path Resolution
Problem: Combined knowledge service looked for agent KB in wrong ChromaDB location (root instead of knowledge subfolder).
Solution: Updated service to use separate ChromaDB client pointing to /app/data/chroma/knowledge.
Impact: Agent KB now correctly found and searched in combined scenarios.

Challenge 4: Missing chunk_index in Results
Problem: Project KB search results didn't include chunk_index field, breaking badge UI rendering.
Solution: Added chunk_index extraction from ChromaDB metadata (line 257 in combined_knowledge_service.py).
Impact: Badge component now displays chunk indices correctly for all sources.

Challenge 5: Source Attribution Clarity
Problem: Users couldn't tell whether Agent KB or Project KB was used in responses.
Solution: Added source_type field to all results and implemented color-coded visual indicators with labels.
Impact: Clear visual distinction between knowledge sources, improved transparency.

TEST SCENARIOS AND VALIDATION
=============================

Scenario A: Agent KB Only (Outside Project Context)
Setup: User not in any project, using agent with configured KB (e.g., ACME agent)
Test Question: "Who founded ACME Corporation?"
Expected Behavior:
- Only Agent KB is searched
- Badge shows: "ðŸ“š 1 doc used (Agent)"
- Dots are cyan/orange color
- Source documents are from agent's KB (acme_company_info.txt)
- Response contains information from agent KB only
Validation Criteria:
âœ“ Badge label shows "(Agent)"
âœ“ Color coding is cyan for all results
âœ“ No project KB results included
âœ“ Correct document names and chunk indices displayed

Scenario B: Combined KB (Agent in Project Context)
Setup: User in project with project KB, using agent with configured KB
Test Question: "What are the Test1 project goals?"
Expected Behavior:
- Both Agent KB and Project KB are searched
- Badge shows: "ðŸ“š X docs used (Project)" or "(Agent + Project)"
- Blue dots for project KB results
- Source documents include project KB files
- Response prioritizes project-specific information
Validation Criteria:
âœ“ Project context indicator visible (brown bar at top)
âœ“ Project KB results included with blue dots
âœ“ Badge label appropriate for sources used
âœ“ Results sorted by similarity across all sources

Scenario C: Project KB Only (Agent Without KB in Project)
Setup: User in project with project KB, using agent without KB (e.g., Tsushin agent)
Test Question: "Who are the Test1 team members?"
Expected Behavior:
- Only Project KB is searched (agent has no KB)
- Badge shows: "ðŸ“š X docs used (Project)"
- All dots are blue color
- Source documents are from project KB only
- Response contains Test1 team information (Sarah, Michael, Emma, David)
Validation Criteria:
âœ“ Badge label shows "(Project)"
âœ“ All results have blue dots (no cyan)
âœ“ No agent KB results included
âœ“ Answer includes Test1 team member names

VALIDATION CHECKLIST
====================
âœ“ chunk_index field included in all search results
âœ“ Similarity scores calculated correctly using cosine distance
âœ“ Color coding works (blue for project, cyan for agent)
âœ“ Badge labels display correct context indicators
âœ“ Source attribution maintained throughout result pipeline
âœ“ Deduplication prevents duplicate chunks in results
âœ“ Results properly sorted by similarity score (descending)
âœ“ Expandable badge UI shows all relevant details
âœ“ Badge renders responsively with agent messages
âœ“ No false positives (unused KBs don't appear in badge)

PROJECT SUCCESS METRICS
=======================
- Knowledge Base Search Accuracy: >95% semantic relevance for test queries
- Source Attribution Accuracy: 100% correct labeling
- Semantic Search Performance: Results returned in <500ms
- UI Responsiveness: Badge loads with message (no delay)
- Color Coding Correctness: 100% correct color assignment
- False Positive Rate: 0% (only used KBs shown)
- User Satisfaction: Clear understanding of knowledge sources used

KNOWN LIMITATIONS AND CONSTRAINTS
=================================
Limitation 1: Result Count Cap
- Maximum 5 results returned per query (configurable)
- Very broad queries may miss relevant chunks
- Mitigation: Users can refine queries for better targeting

Limitation 2: Similarity Threshold Tuning
- Fixed threshold of 0.3 may not suit all use cases
- Some domains may need higher/lower thresholds
- Mitigation: Consider making threshold configurable per project

Limitation 3: Short Query Performance
- Very short queries (1-2 words) may return low similarity scores
- Embedding model works best with complete sentences
- Mitigation: Encourage users to use natural language queries

Limitation 4: Document Processing Time
- Large documents (>1 MB) take longer to process
- Processing happens synchronously in current implementation
- Mitigation: Background task processing already implemented

Limitation 5: Project Context Switching
- Slash commands for project enter/exit have bugs
- Must use UI click to reliably switch project context
- Mitigation: Use sidebar project list for navigation

TEST1 SPECIFIC REFERENCE INFORMATION
====================================
This document (test1_enhanced_project_kb.txt) is specifically designed to test Project KB functionality in the Tsushin platform. It contains rich, structured information across multiple topics to validate semantic search quality and ensure different query types can find relevant knowledge.

Key Topics Covered:
- Test1 project overview and mission
- Team member details (Sarah, Michael, Emma, David)
- Project goals and objectives (5 main goals)
- Technical architecture (embeddings, ChromaDB, processing)
- Timeline and milestones (5 phases)
- Features being tested (4 major features)
- Challenges and solutions (5 documented challenges)
- Test scenarios (3 comprehensive scenarios)
- Validation criteria and success metrics

Questions That Should Match This Document:
- "What is Test1 project about?"
- "Who are the Test1 team members?"
- "What are the Test1 project goals?"
- "What technical stack does Test1 use?"
- "What challenges did Test1 face?"
- "What is the Test1 timeline?"
- "What features are being tested in Test1?"

Expected Behavior:
When these questions are asked in the context of Test1 project, the semantic search should retrieve relevant chunks from this document with high similarity scores (>0.5). The badge should display "(Project)" label with blue dots, and the response should contain specific information from this document (team member names, technical details, project goals, etc.).

DOCUMENT METADATA
=================
Document Name: test1_enhanced_project_kb.txt
Purpose: Comprehensive knowledge base for Test1 project testing
Creation Date: January 6, 2026
Format: Plain Text (TXT)
Size: ~11 KB
Expected Chunks: ~25-30 chunks (500 char chunks with 50 char overlap)
Target Collection: project_5 (ChromaDB)
Storage Path: /app/data/chroma/project_5

This document serves as the primary knowledge source for validating Project KB functionality and demonstrating how project-specific knowledge can be searched, retrieved, and attributed in the Tsushin platform.
